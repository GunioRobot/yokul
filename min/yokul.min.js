YOKUL={};YOKUL.charts={};YOKUL.useContext=function YOKUL_useContext(a,b){a.save();b(a);a.restore();};YOKUL.utility={getQueryDataFromElement:function utility_getQueryDataFromElement(a){return a.dataset.src||a.dataset["chart-src"];},min:function utility_min(c){var b=Number.MAX_VALUE,a;if(!c||!c.length){return undefined;}for(a=0;a<c.length;++a){if(c[a]<b){b=c[a];}}return b;},max:function utility_max(c){var a=Number.MIN_VALUE,b;if(!c||!c.length){return undefined;}for(b=0;b<c.length;++b){if(c[b]>a){a=c[b];}}return a;},min2d:function utility_min2d(c){var d=this.min(c[0]);for(var b=1;b<c.length;++b){var a=this.min(c[b]);if(a<d){d=a;}}return d;},max2d:function utility_max2d(d){var c=this.max(d[0]);for(var b=1;b<d.length;++b){var a=this.max(d[b]);if(a>c){c=a;}}return c;}};YOKUL.log=(function(){function a(e,c){if(YOKUL.logOutput&&YOKUL.logOutput[e]){var b=YOKUL.debugOutput&&document.getElementById(YOKUL.debugOutput);if(!b){console.log(e+c);}else{var d=document.createElement("div");d.className="debug-msg";d.innerHTML="<span class='debug-header "+e+"'>"+e+"</span>"+c+"</span>";b.appendChild(d);}}}return{info:function(b){a("info",b);},error:function(b){a("error",b);},warning:function(b){a("warning",b);}};})();YOKUL.defaults={titleHeight:24,titleFont:"14px sans-serif",titleColor:"#444444",axisLabelHeight:16,axisLabelFont:"11px sans-serif",axisLabelColor:"gray",seriesColor:"#ffcc33",verticalAxisLabelMargin:5.5,gridLines:{dashLength:4,spacingLength:1},seriesRangesByDataEncodingType:{t:{min:0,max:100},s:{min:0,max:61},e:{min:0,max:4095}}};if(typeof CanvasRenderingContext2D.prototype.dashedLine!=="function"){CanvasRenderingContext2D.prototype.dashedLine=function(c,j,b,i,g,f){if(typeof g==="undefined"){g=YOKUL.defaults.gridLines.dashLength;}if(typeof f==="undefined"){f=YOKUL.defaults.gridLines.spacingLength;}this.beginPath();this.moveTo(c,j);if(g===0){this.lineTo(b,i);}else{var e=b-c;var d=i-j;var h=Math.floor(Math.sqrt(e*e+d*d)/g);var l=e/h;var k=d/h;var a=0;while(a++<=h){c+=l;j+=k;this[a%2==0?"moveTo":"lineTo"](c,j);}}this.stroke();this.closePath();};}if(typeof Array.prototype.clone!=="function"){Array.prototype.clone=function Array_clone(){var a=[],c,b=this.length;for(c=0;c<b;++c){a.push(this[c]);}return a;};}if(typeof Array.prototype.contains!=="function"){Array.prototype.contains=function Array_contains(c){var b=0,a=this.length;for(;b<a;++b){if(this[b]===c){return true;}}return false;};}YOKUL.chartTypes={bar:{verticalStacked:"bvs",verticalGrouped:"bvg",specific:{automaticFitBarWidth:"automaticFitBarWidth",},defaults:{barWidth:23,betweenBarWidth:4,betweenGroupWidth:8,betweenBarWidthSoleA:3,betweenGroupWidthSoleA:3}}};YOKUL.chartTypesMap={bvs:YOKUL.chartTypes.bar.verticalStacked,bvg:YOKUL.chartTypes.bar.verticalGrouped};YOKUL.Tokenizer=function Tokenizer(b){if(b===undefined||b===null||b.length===0){throw new Error("Tokenizer: constructed without any input");}var a=/^[^?]+\?(.+)$/.exec(b);if(!a||a.length!==2){throw new Error("Tokenizer: found no valid query input in the raw string: "+b);}this._inputString=a[1];this._tokenize(this._inputString);this._currentIndex=-1;};YOKUL.Tokenizer.prototype._tokenize=function Tokenizer_tokenize(a){this._tokens=[];var e=a.split("&");for(var c=0;c<e.length;++c){var d=e[c];if(!d||d.length===0||d.match(/^[ \t]$/)){continue;}var b=d.split("=");if(b.length!==2){throw new Error("Tokenizer: encountered unexpected input: %%"+d+"%%");}this._tokens.push({key:b[0],value:b[1]});}};YOKUL.Tokenizer.prototype.tokenCount=function Tokenizer_tokenCount(){return this._tokens.length;};YOKUL.Tokenizer.prototype.current=function Tokenizer_current(){return this._tokens[this._currentIndex];};YOKUL.Tokenizer.prototype.moveNext=function Tokenizer_moveNext(){this._currentIndex+=1;return this._currentIndex<this._tokens.length;};YOKUL.BarSpacing=function BarSpacing(b,c,a){this._barWidth=b||YOKUL.chartTypes.bar.defaults.barWidth;if(this._barWidth==="a"&&c===undefined){this._betweenBars=3;}else{this._betweenBars=(c===undefined)?YOKUL.chartTypes.bar.defaults.betweenBarWidth:c;}if(this._barWidth==="a"&&a===undefined){this._betweenGroups=3;}else{this._betweenGroups=(a===undefined)?YOKUL.chartTypes.bar.defaults.betweenGroupWidth:a;}};YOKUL.BarSpacing.prototype.getBarWidth=function BarSpacing_getBarWidth(b,a,c){if(this._barWidth!=="a"){return this._barWidth;}else{if(typeof b==="undefined"||typeof c==="undefined"){throw new Error("BarSpacing.getBarWidth: barWidth is set to automatic, so please provude numBars and availableWidth parameters");}return(c-(this._betweenBars*b)-(this._betweenGroups*a))/b;}};YOKUL.BarSpacing.prototype.getBetweenBars=function BarSpacing_getBetweenBars(){return this._betweenBars;};YOKUL.BarSpacing.prototype.getBetweenGroups=function BarSpacing_getBetweenGroups(){return this._betweenGroups;};YOKUL.BarSpacing.prototype.isAutomaticBarWidth=function BarSpacing_isAutomaticBarWidth(){return this._barWidth==="a";};YOKUL.GridSpacing=function GridSpacing(e,d,c,a,b,f){if(typeof e==="undefined"){throw new Error("GridSpacing: xStepSize is required");}if(typeof d==="undefined"){throw new Error("GridSpacing: yStepSize is required");}this._xStepSize=e;this._yStepSize=d;if(c||a||b||f){throw new Error("GridSpacing: optional features arent implemented yet");}};YOKUL.GridSpacing.prototype.getXStepSize=function GridSpacing_getXStepSize(){return this._xStepSize;};YOKUL.GridSpacing.prototype.getYStepSize=function GridSpacing_getYStepSize(){return this._yStepSize;};YOKUL.Parser=(function(){var d={t:function l(y){function z(E){E=E.replace(/_/g,",null,");var C=[];var D=E.split(",");for(var A=0;A<D.length;++A){var B=D[A];if(B!==undefined&&B!==""){if(B==="null"){C.push(null);}else{C.push(parseFloat(B));}}}return C;}var x=[];var w=y.split("|");for(var v=0;v<w.length;++v){x.push(z(w[v]));}return x;},s:function l(y){function z(B){if(B>="A"&&B<="Z"){return B.charCodeAt(0)-"A".charCodeAt(0);}else{if(B>="a"&&B<="z"){return B.charCodeAt(0)-"a".charCodeAt(0)+26;}else{if(B>="0"&&B<="9"){return B.charCodeAt(0)-"0".charCodeAt(0)+52;}else{return -1;}}}}function A(D){var C=[];for(var B=0;B<D.length;++B){C.push(z(D.charAt(B)));}return C;}var x=[];var w=y.split(",");for(var v=0;v<w.length;++v){x.push(A(w[v]));}return x;}};var s={chs:function k(w){var v=w.split("x");if(v.length!==2){throw new Error("Parser:chs: unexpected input: "+w);}this._size={w:parseInt(v[0],10),h:parseInt(v[1],10)};if(this._size.w>1000){YOKUL.log.warning("Width, "+this._size.w+", is greater than maximum of 1000");}if(this._size.h>1000){YOKUL.log.warning("Height, "+this._size.h+", is greater than maximum of 1000");}},cht:function i(v){this._chartType=YOKUL.chartTypesMap[v];if(this._chartType===undefined){throw new Error("Parser::cht: unknown value: "+v);}},chd:function r(w){var v=w.split(":");if(v.length!==2){throw new Error("Parser::chd: unknown value: "+w);}this._dataEncodingType=v[0];this._chartDataBySeries=d[this._dataEncodingType](v[1]);},chtt:function t(v){v=v.replace(/\+/g," ");this._title=v.split("|");},chts:function u(w){var v=w.split(",");if(v.length!==2){throw new Error("Parser::chts: unexpected value: "+w);}this._titleStyle={color:"#"+v[0],size:parseInt(v[1],10)};},chbh:function b(z){var x,y,v;var w=z.split(",");if(w.length>0){if(w[0]==="a"){x="a";}else{x=parseInt(w[0],10);if(isNaN(x)){x=YOKUL.chartTypes.bar.defaults.barWidth;}}}else{x=YOKUL.chartTypes.bar.defaults.barWidth;}if(w.length>1){y=parseInt(w[1],10);if(isNaN(y)){y=YOKUL.chartTypes.bar.defaults.betweenBarWidth;}}else{if(x==="a"){y=undefined;}else{y=YOKUL.chartTypes.bar.defaults.betweenBarWidth;}}if(w.length>2){v=parseInt(w[2],10);if(isNaN(v)){v=YOKUL.chartTypes.bar.defaults.betweenGroupWidth;}}else{if(x==="a"){v=undefined;}else{v=YOKUL.chartTypes.bar.defaults.betweenGroupWidth;}}this._chartSpacing=new YOKUL.BarSpacing(x,y,v);},chco:function e(y){var x=y.split(",");var v=[];for(var w=0;w<x.length;++w){v.push("#"+x[w]);}this._seriesColors=v;},chds:function n(A){var z=A.split(",");var w=[];for(var y=0;y<z.length;y+=2){var x=parseFloat(z[y]);var v=parseFloat(z[y+1]);w.push({min:x,max:v});}this._seriesRanges=w;},chdl:function q(v){var w=v.split("|");this._legendLabels=w;},chxt:function g(v){this._visibleAxes=v.split(",");},chxr:function h(C){var A=C.split("|");var v=[];for(var z=0;z<A.length;++z){var B=A[z].split(",");var y=parseInt(B[0],10);B=B.splice(1);var x=[];for(var w=0;w<B.length;++w){x.push(parseFloat(B[w]));}v[y]=x;}this._axisRanges=v;},chxl:function m(A){var z=A.split("|");var y={};var w=null;for(var x=0;x<z.length;++x){var A=z[x];if(A.indexOf(":")>-1){var v=parseInt(A,10);y["axis"+v]=[];w=y["axis"+v];}else{if(!w){throw new Error("chxl: invalid value string: "+A);}w.push(A);}}this._axisLabels=y;},chg:function p(w){var v=w.split(",");this._gridSpacing=new YOKUL.GridSpacing(v[0],v[1],v[2],v[3],v[4],v[5]);}};var j=["chem","chfd","chm","chxtc"];function o(w){for(var v=0;v<j.length;++v){if(j[v]===w){return true;}}return false;}var c=function f(v){var y=new YOKUL.Tokenizer(v);while(y.moveNext()){var w=y.current();YOKUL.log.info("token-> "+w.key);if(o(w.key)){YOKUL.log.warning(w.key+": not currently supported, skipping");continue;}var x=s[w.key];if(x===undefined){YOKUL.log.error("unknown token encountered: "+w.key);}else{try{x.call(this,unescape(w.value));}catch(z){YOKUL.log.error("error during handler of: "+w.key+"::: "+z.toString());}}}};return function a(v){if(v===undefined||v===null||v.length===0){throw new Error("Parser: given no input to parse");}c.call(this,v);};})();YOKUL.Parser.prototype._groupChartData=function _Parser_groupChartData(){var f=Number.MIN_VALUE;var d=this._chartDataBySeries;for(var c=0;c<d.length;c+=1){if(d[c].length>f){f=d[c].length;}}var b=[];for(var c=0;c<f;c+=1){var e=[];for(var a=0;a<d.length;a+=1){e.push(d[a][c]);}b.push(e);}return b;};YOKUL.Parser.prototype.size=function Parser_size(){return this._size;};YOKUL.Parser.prototype.chartType=function Parser_chartType(){return this._chartType;};YOKUL.Parser.prototype.getDataEncodingType=function Parser_getDataEncodingType(){return this._dataEncodingType;};YOKUL.Parser.prototype.chartDataBySeries=function Parser_chartDataBySeries(){return this._chartDataBySeries;};YOKUL.Parser.prototype.chartDataGrouped=function Parser_chartDataGrouped(){if(this._chartDataGrouped===undefined){this._chartDataGrouped=this._groupChartData();}return this._chartDataGrouped;};YOKUL.Parser.prototype.title=function Parser_title(){return this._title;};YOKUL.Parser.prototype.titleStyle=function Parser_titleStyle(){return this._titleStyle;};YOKUL.Parser.prototype.chartSpacing=function Parser_chartSpacing(){if(!this._chartSpacing){this._chartSpacing=new YOKUL.BarSpacing();}return this._chartSpacing;};YOKUL.Parser.prototype.hasGridSpacing=function Parser_hasGridSpacing(){return !!(this._gridSpacing);};YOKUL.Parser.prototype.gridSpacing=function Parser_gridSpacing(){return this._gridSpacing;};YOKUL.Parser.prototype.seriesRanges=function Parser_seriesRanges(){return this._seriesRanges;};YOKUL.Parser.prototype.legendLabels=function Parser_legendLabels(){return this._legendLabels;};YOKUL.Parser.prototype.seriesColors=function Parser_seriesColors(){return this._seriesColors;};YOKUL.Parser.prototype.visibleAxes=function Parser_visibleAxes(){if(!this._visibleAxes){this._visibleAxes=[];}return this._visibleAxes;};YOKUL.Parser.prototype.axisRanges=function Parser_axisRanges(){return this._axisRanges;};YOKUL.Parser.prototype.visibleAxesCount=function Parser_visibleAxesCount(d){var e=this.visibleAxes();var c=0;for(var b=0,a=e.length;b<a;++b){if(e[b]===d){++c;}}return c;};YOKUL.Parser.prototype.axisLabels=function Parser_axisLabels(){return this._axisLabels;};YOKUL.Parser.prototype.legendSpecified=function Parser_legendSpecified(){return !!(this._legendLabels);};YOKUL.charts._VerticalBarMixin=(function _VerticalBarMixin(){function o(){return this._imageData;}function n(v){var t=v.title();if(!t){return 0;}var u=v.titleStyle();var s=(u&&(u.size*1.33))||YOKUL.defaults.titleHeight;return s*t.length;}function p(t,v){var u=v.axisRanges();if(u&&u[t]){var s=u[t];return{min:s[0],max:s[1]};}return YOKUL.defaults.seriesRangesByDataEncodingType[v.getDataEncodingType()];}function b(y,v,t,B){var s=t.axisLabels();var C=null;if(s&&s["axis"+y]){C=s["axis"+y];}else{if(v==="y"||v==="r"){C=[];var u=10;var D=this._getAxisRange(y,t);var z=(D.max-D.min)/u;var w=D.min;while(w%z!==0){++w;}for(var x=0;x<=u;++x){C.push(Math.round(w).toString());w+=z;}}else{var A=t.chartDataBySeries()[0].length;C=[];for(var x=0;x<A;++x){C.push(x.toString());}}}return C;}function d(t,u,x){var w=x.visibleAxes().clone(),s;if(!w.contains("x")){w.push("x");}if(!w.contains("y")){w.push("y");}var v={drawXAxis:r,drawYAxis:k,drawTAxis:h,drawRAxis:e};for(s=0;s<w.length;++s){v["draw"+w[s].toUpperCase()+"Axis"](t,u,x);}}function c(v,y,s,z){var C=this;var E=s.visibleAxes();var t=0;v.strokeStyle="Gray";v.fillStyle=YOKUL.defaults.axisLabelColor;v.font=YOKUL.defaults.axisLabelFont;function x(L,K,N){var J=YOKUL.defaults.axisLabelHeight;var F=y.w/K.length;var H=y.x+F/2;var G=y.y+y.h+(J*(L+1));if(z==="t"){G=y.y-((J*(L+1))/2);}for(var I=0;I<K.length;++I){if(N){v.beginPath();v.moveTo(H,G-(J-4));v.lineTo(H,G-(J+1));v.closePath();v.stroke();}var M=v.measureText(K[I]).width;v.fillText(K[I],H-M/2,G);H+=F;}}function B(L,K,N,I,J){if(!I){I=0;}if(!J){J=0;}var Q=YOKUL.defaults.verticalAxisLabelMargin/2+J;var P=y.y-I;var O=y.h;var G=O/(K.length-1);for(var H=K.length-1;H>=0;--H){if(N){v.beginPath();v.moveTo(y.x+0.5,P+0.5);v.lineTo(y.x-3+0.5,P+0.5);v.closePath();v.stroke();}var M=v.measureText(K[H]).width;if(z==="r"){M=0;}var R=y.x-YOKUL.defaults.verticalAxisLabelMargin-2;var F=Q+R-M;v.fillText(K[H],F,P+YOKUL.defaults.axisLabelHeight/4);P+=G;}}function w(){if(z==="r"){return y.w+12;}return 0;}function u(){return 0;}var D=(z==="x"||z==="t")?x:B;for(var A=0;A<E.length;++A){if(E[A]===z){D(t,this._getAxisLabels(A,z,s,(z==="x"||z==="r")?y.w:y.h),z!=="t",u(),w());}}}function f(s,u){var t=u.seriesRanges();if(t&&t[s]){return t[s];}if(t&&t[0]){return t[0];}return YOKUL.defaults.seriesRangesByDataEncodingType[u.getDataEncodingType()];}function g(s,u){var t=u.seriesColors();if(t&&t[s]){return t[s];}if(t&&t[s%t.length]){return t[s%t.length];}return YOKUL.defaults.seriesColor;}function i(x,y,z){x.strokeStyle="#afafaf";var v=z.gridSpacing();var w=Math.ceil(y.w*(v.getXStepSize()/100));var t=Math.ceil(y.h*(v.getYStepSize()/100));var u=y.x+w+0.5;while(u<=y.x+y.w){x.dashedLine(u,y.y+0.5,u,y.y+0.5+y.h);u+=w;}var s=y.y+0.5;while(s<y.y+y.h){x.dashedLine(y.x+0.5,s,y.x+y.w+0.5,s);s+=t;}}function r(s,t,u){s.strokeStyle="gray";s.beginPath();s.moveTo(t.x+0.5,t.y+t.h+0.5);s.lineTo(t.x+t.w+0.5,t.y+t.h+0.5);s.closePath();s.stroke();}function k(s,t,u){s.strokeStyle="gray";s.beginPath();s.moveTo(t.x+0.5,t.y+0.5);s.lineTo(t.x+0.5,t.y+t.h+0.5);s.closePath();s.stroke();}function e(s,t,u){s.strokeStyle="gray";s.beginPath();s.moveTo(t.x+t.w+0.5,t.y+0.5);s.lineTo(t.x+t.w+0.5,t.y+t.h+0.5);s.closePath();s.stroke();}function h(s,t,u){}function q(t,w,s){var B=6;var v=12;var z=s.legendLabels();var u=s.seriesColors();var C=(v+B)*z.length-B;var y=t.canvas.height/2-C/2+v;var A=w.x+w.w+5;for(var x=0;x<z.length;++x){t.save();t.fillStyle=this._getSeriesColor(x,s);t.fillRect(A,y,v,v);t.fillStyle="gray";t.fillText(z[x],A+v+B,y+((v+B)/2));t.restore();y+=v+B;}}function a(t){var s=t.titleStyle();return(s&&s.size+"px sans-serif")||YOKUL.defaults.titleFont;}function m(t){var s=t.titleStyle();return(s&&s.color)||YOKUL.defaults.titleColor;}function j(w,x,v){var B=v.title();if(B){w.font=a(v);w.fillStyle=m(v);var z=0;if(x.x+x.w>w.canvas.width){z=w.canvas.width-x.x;}else{z=x.w;}var u=x.x+z/2;var t=n(v)/B.length;var s=t/3;for(var y=0;y<B.length;++y){var C=B[y];var A=w.measureText(C);w.fillText(C,u-A.width/2,t*(y+1)-s);}}}function l(v,w,s,u){YOKUL.useContext(s,function(x){x.fillStyle="#FFFFFF";x.fillRect(0,0,x.canvas.width,x.canvas.height);});var t=this;if(w.hasGridSpacing()){YOKUL.useContext(s,function(x){t._drawGrid(x,u,w);});}YOKUL.useContext(s,function(x){t._drawChartArea(x,u,w);});YOKUL.useContext(s,function(x){t._drawAxes(x,u,w);});YOKUL.useContext(s,function(x){t._drawAxisLabels(x,u,w,"x");});YOKUL.useContext(s,function(x){t._drawAxisLabels(x,u,w,"y");});YOKUL.useContext(s,function(x){t._drawAxisLabels(x,u,w,"r");});YOKUL.useContext(s,function(x){t._drawAxisLabels(x,u,w,"t");});YOKUL.useContext(s,function(x){t._drawTitle(x,u,w);});if(w.legendSpecified()){YOKUL.useContext(s,function(x){t._drawLegend(x,u,w);});}}return function(){this._getTitleHeight=n;this._getAxisRange=p;this._getAxisLabels=b;this._drawAxes=d;this._drawAxisLabels=c;this._getSeriesRange=f;this._getSeriesColor=g;this._drawGrid=i;this._drawLegend=q;this._drawTitle=j;this._createChartImageCore=l;this.imageData=o;};})();YOKUL.charts.VerticalBarGrouped=function VerticalBarGrouped(a){this._imageData=this._createChartImage(a);};YOKUL.charts._VerticalBarMixin.call(YOKUL.charts.VerticalBarGrouped.prototype);YOKUL.charts.VerticalBarGrouped.prototype._getChartAreaWidth=function vbg_getChartAreaWidth(f){var b=f.chartSpacing();if(b.isAutomaticBarWidth()){return f.size().w;}var d=f.chartDataGrouped();var c=b.getBarWidth();var a=d[0].length;var e=(a*c)+((a-1)*b.getBetweenBars())+(b.getBetweenGroups());return d.length*e;};YOKUL.charts.VerticalBarGrouped.prototype._measureChartArea=function vbg_measureChartArea(d,a){var f=this._getChartAreaWidth(a);var c={x:0,y:0,w:f,h:a.size().h};var b=this._getTitleHeight(a);c.y+=b;c.h-=b;var e=1+(a.visibleAxesCount("y")*(YOKUL.defaults.axisLabelHeight/4));e+=a.visibleAxesCount("x")*YOKUL.defaults.axisLabelHeight;c.h-=e;var g=6;g+=a.visibleAxesCount("t")*YOKUL.defaults.axisLabelHeight;c.y+=g;c.h-=g;var j=this;function m(p,t){var u=j._getAxisLabels(p,t,a,c.h);var o=0;if(u&&u[p]){for(var q=0;q<u.length;++q){var n=d.measureText(u[q]).width;if(n>o){o=n;}}}else{var s=a.chartDataBySeries();if(s&&s[p]){var r=YOKUL.utility.max(s[p]);o=d.measureText(r.toString()).width;}}return o+YOKUL.defaults.verticalAxisLabelMargin*2;}var l=1;var k=a.visibleAxes();for(var h=0;h<k.length;++h){if(k[h]=="y"){l+=m(h,"y");}}c.x+=l;if(a.chartSpacing().isAutomaticBarWidth()){c.w-=l+1;}return c;};YOKUL.charts.VerticalBarGrouped.prototype._drawChartArea=function vbg_drawChartArea(c,n,d){var t=d.chartSpacing();var a=d.chartDataBySeries();var w=d.chartDataGrouped();var f=n.h;var p=n.x;var l=t.getBarWidth(a.length*a[0].length,a.length,n.w);var b=w[0].length;var j=(b*l)+((b-1)*t.getBetweenBars())+(t.getBetweenGroups());for(var u=0;u<w.length;++u){var q=p+(j*u)+t.getBetweenGroups()/2+t.getBetweenBars()/2;for(var s=0;s<w[u].length;++s){var v=this._getSeriesRange(s,d);var k=v.max-v.min;var h=n.y+f*(v.max/k);var o=w[u][s]||0;var m=f*(o/k);var r=Math.abs(m);var e=h;if(o>0){e=h-r;}c.fillStyle=this._getSeriesColor(s,d);c.fillRect(q,e,l,r);q+=l+t.getBetweenBars();}}};YOKUL.charts.VerticalBarGrouped.prototype._createChartImage=function VerticalBarGrouped_createChartImage(d){var e=new YOKUL.Parser(d);var a=document.createElement("canvas");a.width=e.size().w;a.height=e.size().h;var b=a.getContext("2d");var c=this._measureChartArea(b,e);this._createChartImageCore(d,e,b,c);return a.toDataURL("image/png");};YOKUL.charts.VerticalBarStacked=function VerticalBarStacked(a){this._imageData=this._createChartImage(a);};YOKUL.charts._VerticalBarMixin.call(YOKUL.charts.VerticalBarStacked.prototype);YOKUL.charts.VerticalBarStacked.prototype._getChartAreaWidth=function vbs_getChartAreaWidth(f){var a=f.chartSpacing();if(a.isAutomaticBarWidth()){return f.size().w;}var d=f.chartDataGrouped();var b=a.getBarWidth();var e=d.length;var c=b+a.getBetweenBars();return e*c;};YOKUL.charts.VerticalBarStacked.prototype._measureChartArea=function vbs_measureChartArea(d,a){var f=this._getChartAreaWidth(a);var c={x:0,y:0,w:f,h:a.size().h};var b=this._getTitleHeight(a);c.y+=b;c.h-=b;var e=1+(a.visibleAxesCount("y")*(YOKUL.defaults.axisLabelHeight/4));e+=a.visibleAxesCount("x")*YOKUL.defaults.axisLabelHeight;c.h-=e;var g=6;g+=a.visibleAxesCount("t")*YOKUL.defaults.axisLabelHeight;c.y+=g;c.h-=g;var j=this;function m(p,t){var u=j._getAxisLabels(p,t,a,c.h);var o=0;if(u&&u[p]){for(var q=0;q<u.length;++q){var n=d.measureText(u[q]).width;if(n>o){o=n;}}}else{var s=a.chartDataBySeries();if(s&&s[p]){var r=YOKUL.utility.max(s[p]);o=d.measureText(r.toString()).width;}}return o+YOKUL.defaults.verticalAxisLabelMargin*2;}var l=1;var k=a.visibleAxes();for(var h=0;h<k.length;++h){if(k[h]=="y"){l+=m(h,"y");}}c.x+=l;if(a.chartSpacing().isAutomaticBarWidth()){c.w-=l+1;}return c;};YOKUL.charts.VerticalBarStacked.prototype._drawChartArea=function vbs_drawChartArea(c,n,d){var t=d.chartSpacing();var b=d.chartDataBySeries();var w=d.chartDataGrouped();var f=n.h;var p=n.x;var l=t.getBarWidth(b.length*b[0].length,b.length,n.w);var j=l+t.getBetweenBars();for(var u=0;u<w.length;++u){var q=p+(j*u)+t.getBetweenBars()/2;var a=0;for(var s=0;s<w[u].length;++s){var o=w[u][s]||0;if(o<=0){continue;}var v=this._getSeriesRange(s,d);var k=v.max-v.min;var h=n.y+f*(v.max/k);var m=f*(o/k);var r=Math.abs(m);var e=h;if(o>0){e=h-r;}c.fillStyle=this._getSeriesColor(s,d);c.fillRect(q,e-a,l,r);a+=r;}}};YOKUL.charts.VerticalBarStacked.prototype._createChartImage=function vbs_createChartImage(d){var e=new YOKUL.Parser(d);var a=document.createElement("canvas");a.width=e.size().w;a.height=e.size().h;var b=a.getContext("2d");var c=this._measureChartArea(b,e);this._createChartImageCore(d,e,b,c);return a.toDataURL("image/png");};YOKUL.chartCreator=(function(){_chartConstructors={bvg:YOKUL.charts.VerticalBarGrouped,bvs:YOKUL.charts.VerticalBarStacked};function b(c){var e=/cht=([^&]+)/;var d=e.exec(c);return d&&d[1];}function a(c){var d=b(c);var e=_chartConstructors[d];if(e){return new e(c);}else{YOKUL.log.error("This chart type not yet supported: "+d);return null;}}return{create:function(f,c){var d=document.getElementById(f);if(!d){YOKUL.log.error("chartCreator.create: no element with id, "+f+", exists");return;}if(d.nodeName.toUpperCase()!=="IMG"){YOKUL.log.error("chartCreator.create: YOKUL can only create charts for img elements, passed in: "+d.nodeName);return;}if(typeof c==="undefined"){c=YOKUL.utility.getQueryDataFromElement(d);if(!c){YOKUL.log.error("chartCreator.create: no query data for this chart was found ("+f+")");return;}}var e=a(c);if(e){d.src=e.imageData();}}};})();